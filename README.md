# æ–‡åŒ–æ˜Ÿäº‘ (WenHua WebGIS)

> èæ±‡æ—¶ç©ºæ™ºæ…§ï¼Œä¸­åæ–‡æ˜ - è‡ªç”±æ¢ç´¢ Â· æ˜Ÿé™…æ¼«æ¸¸

ä¸€ä¸ªåŸºäº WebGIS æŠ€æœ¯çš„ä¸­åæ–‡åŒ–å®ä½“å¯è§†åŒ–ä¸æ¢ç´¢å¹³å°ï¼Œé€šè¿‡ 3D æ˜Ÿäº‘å¯è§†åŒ–ã€äº¤äº’å¼åœ°å›¾å’ŒçŸ¥è¯†å›¾è°±ï¼Œä¸ºç”¨æˆ·æä¾›æ²‰æµ¸å¼çš„æ–‡åŒ–æ¢ç´¢ä½“éªŒã€‚

## ğŸ“‹ ç›®å½•

- [é¡¹ç›®ç®€ä»‹](#é¡¹ç›®ç®€ä»‹)
- [æ ¸å¿ƒåŠŸèƒ½](#æ ¸å¿ƒåŠŸèƒ½)
- [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
- [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
- [ç¯å¢ƒè¦æ±‚](#ç¯å¢ƒè¦æ±‚)
- [å®‰è£…éƒ¨ç½²](#å®‰è£…éƒ¨ç½²)
- [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
- [ä½¿ç”¨æŒ‡å—](#ä½¿ç”¨æŒ‡å—)
- [API æ–‡æ¡£](#api-æ–‡æ¡£)
- [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
- [å¼€å‘æŒ‡å—](#å¼€å‘æŒ‡å—)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
- [è´¡çŒ®æŒ‡å—](#è´¡çŒ®æŒ‡å—)
- [è®¸å¯è¯](#è®¸å¯è¯)

## ğŸ¯ é¡¹ç›®ç®€ä»‹

æ–‡åŒ–æ˜Ÿäº‘æ˜¯ä¸€ä¸ªåˆ›æ–°çš„ WebGIS åº”ç”¨ï¼Œæ—¨åœ¨é€šè¿‡ç°ä»£åŒ–çš„å¯è§†åŒ–æŠ€æœ¯å±•ç¤ºå’Œæ¢ç´¢ä¸­åæ–‡åŒ–å®ä½“ã€‚é¡¹ç›®å°†æ–‡åŒ–é—å€ã€å†å²äººç‰©ã€é‡è¦äº‹ä»¶ã€æ–‡ç‰©å™¨ç‰©å’Œæ–‡çŒ®èµ„æ–™ç­‰æ–‡åŒ–å®ä½“ï¼Œä»¥ 3D æ˜Ÿäº‘çš„å½¢å¼å‘ˆç°ï¼ŒåŒæ—¶æä¾›ä¼ ç»Ÿåœ°å›¾è§†å›¾å’ŒçŸ¥è¯†å›¾è°±å…³è”åˆ†æã€‚

### æ ¸å¿ƒç‰¹è‰²

- ğŸŒŒ **3D æ˜Ÿäº‘å¯è§†åŒ–**ï¼šä½¿ç”¨ Three.js æ„å»ºçš„æ²‰æµ¸å¼ 3D åœºæ™¯ï¼Œæ–‡åŒ–å®ä½“ä»¥æ˜Ÿçƒå½¢å¼å‘ˆç°
- ğŸ—ºï¸ **äº¤äº’å¼åœ°å›¾**ï¼šåŸºäº Leaflet çš„åœ°ç†ä¿¡æ¯å±•ç¤ºï¼Œæ”¯æŒå†å²èˆ†å›¾å åŠ 
- ğŸ•¸ï¸ **çŸ¥è¯†å›¾è°±**ï¼šNeo4j é©±åŠ¨çš„å®ä½“å…³ç³»ç½‘ç»œï¼Œæ­ç¤ºæ–‡åŒ–å®ä½“é—´çš„æ·±å±‚è”ç³»
- ğŸ‘¤ **ç”¨æˆ·ç³»ç»Ÿ**ï¼šç”¨æˆ·ç™»å½•ã€è¶³è¿¹è®°å½•ã€æ–‡åŒ– IP æäº¤ä¸å®¡æ ¸
- ğŸ¨ **ç°ä»£ UI**ï¼šç»ç’ƒæ€è®¾è®¡é£æ ¼ï¼Œå“åº”å¼å¸ƒå±€ï¼Œæ”¯æŒæ·±è‰²/æµ…è‰²ä¸»é¢˜åˆ‡æ¢

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### 1. æ˜Ÿäº‘æ¼«æ¸¸ (Home)

- **3D æ˜Ÿç³»å¯è§†åŒ–**ï¼šæ–‡åŒ–å®ä½“æŒ‰æœä»£æˆ–ç±»å‹èšç±»ï¼Œå½¢æˆä¸åŒçš„æ˜Ÿç³»
- **äº¤äº’å¼æ¢ç´¢**ï¼šé¼ æ ‡æ‹–æ‹½æ—‹è½¬ã€æ»šè½®ç¼©æ”¾ã€ç‚¹å‡»èšç„¦
- **æ™ºèƒ½æœç´¢**ï¼šå®æ—¶æœç´¢æ–‡åŒ–å®ä½“ï¼Œæ”¯æŒçƒ­ç‚¹æ¨é€
- **æ‰‹åŠ¿æ§åˆ¶**ï¼šåŸºäº MediaPipe çš„æ‰‹åŠ¿è¯†åˆ«ï¼Œæ”¯æŒæ‰‹åŠ¿åˆ‡æ¢æœä»£
- **çŸ¥è¯†å…³è”**ï¼šç‚¹å‡»å®ä½“æŸ¥çœ‹å…³è”èŠ‚ç‚¹ï¼Œæ˜¾ç¤ºçŸ¥è¯†å›¾è°±å…³ç³»

### 2. åœ°å›¾èˆ†å›¾ (Map)

- **åœ°ç†ä¿¡æ¯å±•ç¤º**ï¼šæ–‡åŒ–å®ä½“åœ¨åœ°å›¾ä¸Šçš„ç²¾ç¡®ä½ç½®æ ‡è®°
- **å›¾å±‚ç®¡ç†**ï¼šæŒ‰æœä»£ã€ç±»å‹ç­›é€‰æ˜¾ç¤º
- **å†å²èˆ†å›¾å åŠ **ï¼šæ”¯æŒåŠ è½½å†å²åœ°å›¾ä½œä¸ºåº•å›¾ï¼Œå¯è°ƒæ•´é€æ˜åº¦å’Œä½ç½®
- **æ™ºèƒ½è·¯çº¿è§„åˆ’**ï¼šæ”¯æŒç›´çº¿ã€é©¾è½¦ã€AI ä¸‰ç§æ¨¡å¼çš„è·¯çº¿è§„åˆ’
- **åˆ†æå·¥å…·**ï¼š
  - æ—¶ç©ºçƒ­åŠ›å›¾
  - æ™ºèƒ½èšåˆ
  - ç¼“å†²åŒºåˆ†æ
  - èŒƒå›´è¾¹ç•Œè®¡ç®—
- **ä¸»é¢˜åˆ‡æ¢**ï¼šæ·±è‰²/æµ…è‰²æ¨¡å¼

### 3. ç”¨æˆ·ç©ºé—´ (User)

- **ç”¨æˆ·ç™»å½•**ï¼šæ”¯æŒæ™®é€šç”¨æˆ·å’Œç®¡ç†å‘˜ä¸¤ç§è§’è‰²
- **è¶³è¿¹è®°å½•**ï¼šè®°å½•ç”¨æˆ·è®¿é—®è¿‡çš„æ–‡åŒ–å®ä½“ï¼Œåœ¨åœ°å›¾ä¸Šå¯è§†åŒ–
- **åˆ›ä½œä¸­å¿ƒ**ï¼šç”¨æˆ·å¯æäº¤æ–°çš„æ–‡åŒ– IPï¼Œç­‰å¾…ç®¡ç†å‘˜å®¡æ ¸
- **å®¡æ ¸å·¥ä½œå°**ï¼šç®¡ç†å‘˜å¯å®¡æ ¸ç”¨æˆ·æäº¤çš„å†…å®¹

### 4. æ–‡åŒ–å®ä½“è¯¦æƒ… (IP)

- **è¯¦ç»†ä¿¡æ¯å±•ç¤º**ï¼šæ–‡åŒ–å®ä½“çš„å®Œæ•´ä¿¡æ¯
- **3D æ¨¡å‹å±•ç¤º**ï¼šæ”¯æŒ GLTF/GLB æ ¼å¼çš„ 3D æ¨¡å‹
- **çŸ¥è¯†å›¾è°±å¯è§†åŒ–**ï¼šä½¿ç”¨ Force Graph å±•ç¤ºå®ä½“å…³ç³»ç½‘ç»œ
- **åœ°å›¾å®šä½**ï¼šæ˜¾ç¤ºå®ä½“åœ¨åœ°å›¾ä¸Šçš„ä½ç½®

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### åç«¯æŠ€æœ¯æ ˆ

- **è¿è¡Œç¯å¢ƒ**ï¼šNode.js (ES Modules)
- **Web æ¡†æ¶**ï¼šExpress.js
- **æ•°æ®åº“**ï¼š
  - PostgreSQLï¼šå­˜å‚¨æ–‡åŒ–å®ä½“ã€ç”¨æˆ·ã€æœä»£ç­‰ç»“æ„åŒ–æ•°æ®
  - Neo4jï¼šå­˜å‚¨çŸ¥è¯†å›¾è°±å…³ç³»æ•°æ®
- **å…¶ä»–ä¾èµ–**ï¼š
  - `cors`ï¼šè·¨åŸŸèµ„æºå…±äº«
  - `dotenv`ï¼šç¯å¢ƒå˜é‡ç®¡ç†
  - `nanoid`ï¼šå”¯ä¸€ ID ç”Ÿæˆ
  - `pg`ï¼šPostgreSQL é©±åŠ¨
  - `neo4j-driver`ï¼šNeo4j é©±åŠ¨

### å‰ç«¯æŠ€æœ¯æ ˆ

- **æ ¸å¿ƒæ¡†æ¶**ï¼šåŸç”Ÿ JavaScript (ES6 Modules)
- **3D æ¸²æŸ“**ï¼šThree.js (r128)
- **åœ°å›¾åº“**ï¼šLeaflet.js
- **UI æ¡†æ¶**ï¼šTailwind CSS
- **å›¾æ ‡åº“**ï¼šFont Awesome 6.4.0
- **å­—ä½“**ï¼šNoto Serif SC (ä¸­æ–‡å­—ä½“)ã€Orbitron (ç§‘æŠ€å­—ä½“)
- **å…¶ä»–åº“**ï¼š
  - Tween.jsï¼šåŠ¨ç”»è¡¥é—´
  - Force Graphï¼šçŸ¥è¯†å›¾è°±å¯è§†åŒ–
  - MediaPipeï¼šæ‰‹åŠ¿è¯†åˆ«
  - Turf.jsï¼šåœ°ç†ç©ºé—´åˆ†æ

### ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å‰ç«¯ (Frontend)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Home    â”‚  â”‚   Map    â”‚  â”‚   User   â”‚  â”‚    IP    â”‚ â”‚
â”‚  â”‚ (æ˜Ÿäº‘)    â”‚  â”‚  (åœ°å›¾)   â”‚  â”‚  (ç”¨æˆ·)   â”‚  â”‚  (è¯¦æƒ…)   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚       â”‚              â”‚              â”‚              â”‚      â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                          â”‚                                â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                          â”‚
â”‚                    â”‚  API è°ƒç”¨  â”‚                          â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   åç«¯ (Backend)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Express.js Server                       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚ â”‚
â”‚  â”‚  â”‚  è®¤è¯API  â”‚  â”‚  ä¸šåŠ¡API  â”‚  â”‚  æ•°æ®API  â”‚          â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                          â”‚                                â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚       â”‚                                    â”‚              â”‚
â”‚  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”                        â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”         â”‚
â”‚  â”‚PostgreSQLâ”‚                        â”‚  Neo4j  â”‚         â”‚
â”‚  â”‚  (ä¸»æ•°æ®) â”‚                        â”‚(çŸ¥è¯†å›¾è°±)â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
wenhuachanye/
â”œâ”€â”€ backend/                 # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ db.js               # PostgreSQL æ•°æ®åº“æ“ä½œ
â”‚   â”œâ”€â”€ neo4j.js            # Neo4j çŸ¥è¯†å›¾è°±æ“ä½œ
â”‚   â”œâ”€â”€ server.js           # Express æœåŠ¡å™¨ä¸»æ–‡ä»¶
â”‚   â”œâ”€â”€ package.json        # åç«¯ä¾èµ–é…ç½®
â”‚   â””â”€â”€ node_modules/       # åç«¯ä¾èµ–åŒ…
â”‚
â”œâ”€â”€ frontend/               # å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ pages/              # HTML é¡µé¢
â”‚   â”‚   â”œâ”€â”€ intro.html      # å¼€åœºé¡µé¢
â”‚   â”‚   â”œâ”€â”€ home.html       # æ˜Ÿäº‘æ¼«æ¸¸é¡µé¢
â”‚   â”‚   â”œâ”€â”€ map.html        # åœ°å›¾é¡µé¢
â”‚   â”‚   â”œâ”€â”€ user.html       # ç”¨æˆ·ä¸­å¿ƒé¡µé¢
â”‚   â”‚   â””â”€â”€ ip.html         # æ–‡åŒ–å®ä½“è¯¦æƒ…é¡µé¢
â”‚   â”‚
â”‚   â”œâ”€â”€ assets/             # é™æ€èµ„æº
â”‚   â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â”‚   â””â”€â”€ styles.css  # å…¨å±€æ ·å¼
â”‚   â”‚   â”œâ”€â”€ js/             # JavaScript æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ data.js     # æ•°æ®è·å–
â”‚   â”‚   â”‚   â”œâ”€â”€ home.js     # æ˜Ÿäº‘é¡µé¢é€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ map.js      # åœ°å›¾é¡µé¢é€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ user.js     # ç”¨æˆ·é¡µé¢é€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ ip.js       # è¯¦æƒ…é¡µé¢é€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ search.js   # æœç´¢åŠŸèƒ½
â”‚   â”‚   â”‚   â””â”€â”€ map-search.js # åœ°å›¾æœç´¢
â”‚   â”‚   â”œâ”€â”€ images/         # å›¾ç‰‡èµ„æº
â”‚   â”‚   â””â”€â”€ data/           # æ•°æ®æ–‡ä»¶ï¼ˆ3D æ¨¡å‹ã€å›¾ç‰‡ç­‰ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ package.json        # å‰ç«¯ä¾èµ–é…ç½®
â”‚   â””â”€â”€ node_modules/       # å‰ç«¯ä¾èµ–åŒ…
â”‚
â”œâ”€â”€ package.json            # æ ¹ç›®å½•ä¾èµ–ï¼ˆNeo4j é©±åŠ¨ï¼‰
â””â”€â”€ README.md              # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

## ğŸ”§ ç¯å¢ƒè¦æ±‚

### å¿…éœ€ç¯å¢ƒ

- **Node.js**ï¼š>= 14.0.0
- **PostgreSQL**ï¼š>= 12.0
- **Neo4j**ï¼š>= 4.0
- **npm** æˆ– **yarn**

### æ¨èç¯å¢ƒ

- Node.js 18.x LTS
- PostgreSQL 14+
- Neo4j 5.x
- ç°ä»£æµè§ˆå™¨ï¼ˆChrome 90+, Firefox 88+, Edge 90+, Safari 14+ï¼‰

## ğŸš€ å®‰è£…éƒ¨ç½²

### 1. å…‹éš†é¡¹ç›®

```bash
git clone <repository-url>
cd wenhuachanye
```

### 2. å®‰è£…ä¾èµ–

```bash
# å®‰è£…åç«¯ä¾èµ–
cd backend
npm install

# å®‰è£…å‰ç«¯ä¾èµ–
cd ../frontend
npm install

# è¿”å›æ ¹ç›®å½•
cd ..
```

### 3. æ•°æ®åº“é…ç½®

#### PostgreSQL é…ç½®

1. åˆ›å»ºæ•°æ®åº“ï¼š

```sql
CREATE DATABASE webgis;
```

2. åˆ›å»ºå¿…è¦çš„è¡¨ç»“æ„ï¼ˆéœ€è¦æ ¹æ®å®é™…éœ€æ±‚åˆ›å»ºä»¥ä¸‹è¡¨ï¼‰ï¼š
   - `cultural_entity`ï¼šæ–‡åŒ–å®ä½“ä¸»è¡¨
   - `site`ï¼šé—å€è¡¨
   - `person`ï¼šäººç‰©è¡¨
   - `event`ï¼šäº‹ä»¶è¡¨
   - `artifact`ï¼šå™¨ç‰©è¡¨
   - `literature`ï¼šæ–‡çŒ®è¡¨
   - `dynasty`ï¼šæœä»£è¡¨
   - `users`ï¼šç”¨æˆ·è¡¨
   - `user_footprints`ï¼šç”¨æˆ·è¶³è¿¹è¡¨
   - `place`ï¼šåœ°ç‚¹è¡¨ï¼ˆç”¨äºåæ ‡æŸ¥è¯¢ï¼‰

#### Neo4j é…ç½®

1. å¯åŠ¨ Neo4j æœåŠ¡
2. åˆ›å»ºçŸ¥è¯†å›¾è°±èŠ‚ç‚¹å’Œå…³ç³»ï¼ˆæ ¹æ®å®é™…æ•°æ®å¯¼å…¥ï¼‰

### 4. ç¯å¢ƒå˜é‡é…ç½®

åœ¨ `backend` ç›®å½•ä¸‹åˆ›å»º `.env` æ–‡ä»¶ï¼š

```env
# æœåŠ¡å™¨é…ç½®
PORT=3000

# PostgreSQL é…ç½®
DB_HOST=localhost
DB_PORT=5432
DB_NAME=webgis
DB_USER=postgres
DB_PASSWORD=your_password

# Neo4j é…ç½®ï¼ˆåœ¨ neo4j.js ä¸­ç¡¬ç¼–ç ï¼Œå»ºè®®æ”¹ä¸ºç¯å¢ƒå˜é‡ï¼‰
# NEO4J_URI=neo4j://localhost:7687
# NEO4J_USER=neo4j
# NEO4J_PASSWORD=your_password
```

### 5. å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨åç«¯æœåŠ¡
cd backend
npm start

# æœåŠ¡å°†åœ¨ http://localhost:3000 å¯åŠ¨
```

### 6. è®¿é—®åº”ç”¨

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š`http://localhost:3000/pages/intro.html`

## âš™ï¸ é…ç½®è¯´æ˜

### åç«¯é…ç½®

#### æ•°æ®åº“è¿æ¥

åœ¨ `backend/db.js` ä¸­é…ç½® PostgreSQL è¿æ¥ï¼š

```javascript
const pool = new Pool({
  host: process.env.DB_HOST || 'localhost',
  port: process.env.DB_PORT || 5432,
  database: process.env.DB_NAME || 'webgis',
  user: process.env.DB_USER || 'postgres',
  password: process.env.DB_PASSWORD || '051006',
  // ...
});
```

#### Neo4j è¿æ¥

åœ¨ `backend/neo4j.js` ä¸­é…ç½® Neo4j è¿æ¥ï¼š

```javascript
const driver = neo4j.driver(
  'neo4j://localhost:7687',
  neo4j.auth.basic('neo4j', 'your_password')
);
```

### å‰ç«¯é…ç½®

#### API åœ°å€

åœ¨ `frontend/assets/js/data.js` ä¸­é…ç½®åç«¯ API åœ°å€ï¼š

```javascript
export const SERVER_URL = 'http://localhost:3000';
```

## ğŸ“– ä½¿ç”¨æŒ‡å—

### ç”¨æˆ·è§’è‰²

#### æ™®é€šç”¨æˆ·

- **ç™»å½•è´¦å·**ï¼š`user` / `123456`
- **åŠŸèƒ½æƒé™**ï¼š
  - æµè§ˆæ–‡åŒ–å®ä½“
  - æœç´¢å’Œæ¢ç´¢
  - æŸ¥çœ‹çŸ¥è¯†å›¾è°±
  - æäº¤æ–°çš„æ–‡åŒ– IP
  - æŸ¥çœ‹ä¸ªäººè¶³è¿¹

#### ç®¡ç†å‘˜

- **ç™»å½•è´¦å·**ï¼š`admin` / `admin888`
- **é¢å¤–æƒé™**ï¼š
  - å®¡æ ¸ç”¨æˆ·æäº¤çš„æ–‡åŒ– IP
  - æ‰¹å‡†æˆ–æ‹’ç»å†…å®¹

### ä¸»è¦åŠŸèƒ½ä½¿ç”¨

#### 1. æ˜Ÿäº‘æ¼«æ¸¸

1. è¿›å…¥æ˜Ÿäº‘é¡µé¢åï¼Œå¯ä»¥çœ‹åˆ°æŒ‰æœä»£æˆ–ç±»å‹ç»„ç»‡çš„ 3D æ˜Ÿç³»
2. ä½¿ç”¨é¼ æ ‡æ‹–æ‹½æ—‹è½¬è§†è§’ï¼Œæ»šè½®ç¼©æ”¾
3. ç‚¹å‡»æ˜ŸçƒæŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
4. ä½¿ç”¨æœç´¢æ¡†å¿«é€ŸæŸ¥æ‰¾æ–‡åŒ–å®ä½“
5. ç‚¹å‡»"å¼€å¯æ‰‹åŠ¿æ§åˆ¶"å¯ä½¿ç”¨æ‰‹åŠ¿åˆ‡æ¢æœä»£

#### 2. åœ°å›¾æ¢ç´¢

1. åœ¨åœ°å›¾é¡µé¢æŸ¥çœ‹æ–‡åŒ–å®ä½“çš„åœ°ç†åˆ†å¸ƒ
2. ä½¿ç”¨å·¦ä¾§å·¥å…·é¢æ¿ï¼š
   - **å›¾å±‚ç®¡ç†**ï¼šæŒ‰æœä»£æˆ–ç±»å‹ç­›é€‰
   - **å†å²èˆ†å›¾**ï¼šå åŠ å†å²åœ°å›¾
   - **è·¯çº¿è§„åˆ’**ï¼šè§„åˆ’è®¿é—®è·¯çº¿
   - **åˆ†æå·¥å…·**ï¼šè¿›è¡Œç©ºé—´åˆ†æ
3. ç‚¹å‡»åœ°å›¾æ ‡è®°æŸ¥çœ‹å®ä½“ä¿¡æ¯

#### 3. æäº¤æ–‡åŒ– IP

1. ç™»å½•åè¿›å…¥"æˆ‘çš„ç©ºé—´"
2. ç‚¹å‡»"åˆ›ä½œä¸­å¿ƒ"
3. å¡«å†™æ–‡åŒ–å®ä½“ä¿¡æ¯ï¼š
   - åç§°ã€ç±»å‹ã€æœä»£
   - æè¿°
   - ç»çº¬åº¦åæ ‡
4. æäº¤åç­‰å¾…ç®¡ç†å‘˜å®¡æ ¸

## ğŸ“¡ API æ–‡æ¡£

### è®¤è¯æ¥å£

#### POST /api/login

ç”¨æˆ·ç™»å½•

**è¯·æ±‚ä½“**ï¼š
```json
{
  "username": "user",
  "password": "123456"
}
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "user": {
    "id": "xxx",
    "username": "user",
    "role": "user"
  }
}
```

### ä¸šåŠ¡æ¥å£

#### GET /api/cultural-entities

è·å–æ‰€æœ‰å·²å‘å¸ƒçš„æ–‡åŒ–å®ä½“

**å“åº”**ï¼š
```json
{
  "success": true,
  "data": [
    {
      "id": "xxx",
      "name": "å®ä½“åç§°",
      "type": "site",
      "dynasty": "å”ä»£",
      "dynasty_id": "tang",
      "dynasty_color": "#ffd700",
      "desc": "æè¿°",
      "lat": 34.0,
      "lng": 108.0,
      "images": [],
      "tags": [],
      "kg_node_id": "kg_xxx"
    }
  ]
}
```

#### GET /api/cultural-entities/:id

è·å–å•ä¸ªæ–‡åŒ–å®ä½“è¯¦ç»†ä¿¡æ¯

#### GET /api/knowledge-graph/:id

è·å–çŸ¥è¯†å›¾è°±æ•°æ®

**å“åº”**ï¼š
```json
{
  "success": true,
  "data": {
    "neighbors": [
      {
        "id": "kg_xxx",
        "name": "å…³è”å®ä½“",
        "labels": ["Node"],
        "uuid": "entity_uuid"
      }
    ],
    "triples": [
      {
        "head": "å®ä½“A",
        "relation": "RELATED_TO",
        "tail": "å®ä½“B"
      }
    ]
  }
}
```

#### GET /api/dynasties

è·å–æ‰€æœ‰æœä»£ä¿¡æ¯

#### POST /api/submit

æäº¤æ–°çš„æ–‡åŒ– IPï¼ˆéœ€è¦ç™»å½•ï¼‰

**è¯·æ±‚ä½“**ï¼š
```json
{
  "userId": "user_id",
  "newIP": {
    "name": "å®ä½“åç§°",
    "type": "site",
    "dynasty_id": "tang",
    "desc": "æè¿°",
    "lat": 34.0,
    "lng": 108.0
  }
}
```

#### GET /api/admin/pending

è·å–å¾…å®¡æ ¸åˆ—è¡¨ï¼ˆä»…ç®¡ç†å‘˜ï¼‰

#### POST /api/admin/audit

å®¡æ ¸æ“ä½œï¼ˆä»…ç®¡ç†å‘˜ï¼‰

**è¯·æ±‚ä½“**ï¼š
```json
{
  "id": "entity_id",
  "status": "published" // æˆ– "rejected"
}
```

#### GET /api/user/footprints

è·å–ç”¨æˆ·è¶³è¿¹

**æŸ¥è¯¢å‚æ•°**ï¼š`userId`

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### PostgreSQL è¡¨ç»“æ„

#### cultural_entityï¼ˆæ–‡åŒ–å®ä½“ä¸»è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID | ä¸»é”® |
| name | VARCHAR | å®ä½“åç§° |
| type | VARCHAR | ç±»å‹ï¼ˆsite/person/event/artifact/literatureï¼‰ |
| description | TEXT | æè¿° |
| dynasty_id | VARCHAR | æœä»£ ID |
| images | JSONB | å›¾ç‰‡æ•°ç»„ |
| tags | JSONB | æ ‡ç­¾æ•°ç»„ |
| meta_info | JSONB | å…ƒä¿¡æ¯ |
| kg_node_id | VARCHAR | çŸ¥è¯†å›¾è°±èŠ‚ç‚¹ ID |
| status | VARCHAR | çŠ¶æ€ï¼ˆpublished/pending/rejectedï¼‰ |
| creator_id | UUID | åˆ›å»ºè€… ID |
| created_at | TIMESTAMP | åˆ›å»ºæ—¶é—´ |

#### siteï¼ˆé—å€è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID | ä¸»é”®ï¼ˆå…³è” cultural_entity.idï¼‰ |
| name | VARCHAR | åç§° |
| site_type | VARCHAR | é—å€ç±»å‹ |
| geometry | POINT | åœ°ç†ä½ç½®ï¼ˆPostGISï¼‰ |
| address_modern | VARCHAR | ç°ä»£åœ°å€ |
| exist_status | VARCHAR | å­˜åœ¨çŠ¶æ€ |
| construction_year | INTEGER | å»ºé€ å¹´ä»½ |

#### personï¼ˆäººç‰©è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID | ä¸»é”® |
| name | VARCHAR | å§“å |
| alternative_names | JSONB | åˆ«å |
| gender | VARCHAR | æ€§åˆ« |
| birth_year | INTEGER | å‡ºç”Ÿå¹´ä»½ |
| death_year | INTEGER | æ­»äº¡å¹´ä»½ |
| birth_place_name | VARCHAR | å‡ºç”Ÿåœ° |
| titles | JSONB | ç§°å· |
| ethnicity | VARCHAR | æ°‘æ— |
| biography | TEXT | ä¼ è®° |

#### eventï¼ˆäº‹ä»¶è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID | ä¸»é”® |
| name | VARCHAR | äº‹ä»¶åç§° |
| event_type | VARCHAR | äº‹ä»¶ç±»å‹ |
| start_date | DATE | å¼€å§‹æ—¥æœŸ |
| end_date | DATE | ç»“æŸæ—¥æœŸ |
| year_range | VARCHAR | å¹´ä»½èŒƒå›´ |
| date_display | VARCHAR | æ—¥æœŸæ˜¾ç¤º |
| location_name | VARCHAR | åœ°ç‚¹åç§° |
| outcome | TEXT | ç»“æœ |

#### artifactï¼ˆå™¨ç‰©è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID | ä¸»é”® |
| name | VARCHAR | åç§° |
| material | VARCHAR | æè´¨ |
| craft | VARCHAR | å·¥è‰º |
| discovered_at | VARCHAR | å‘ç°åœ°ç‚¹ |
| preserved_at | VARCHAR | ä¿å­˜åœ°ç‚¹ |

#### literatureï¼ˆæ–‡çŒ®è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID | ä¸»é”® |
| title | VARCHAR | æ ‡é¢˜ |
| genre | VARCHAR | ä½“è£ |
| author_name | VARCHAR | ä½œè€… |
| year | INTEGER | å¹´ä»½ |
| content_summary | TEXT | å†…å®¹æ‘˜è¦ |

#### dynastyï¼ˆæœä»£è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | VARCHAR | ä¸»é”® |
| name | VARCHAR | åç§° |
| full_name | VARCHAR | å…¨ç§° |
| start_year | INTEGER | èµ·å§‹å¹´ä»½ |
| end_year | INTEGER | ç»“æŸå¹´ä»½ |
| capital_name | VARCHAR | éƒ½åŸ |
| color_hex | VARCHAR | é¢œè‰²ä»£ç  |

#### usersï¼ˆç”¨æˆ·è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID | ä¸»é”® |
| username | VARCHAR | ç”¨æˆ·å |
| password | VARCHAR | å¯†ç ï¼ˆæ˜æ–‡ï¼Œç”Ÿäº§ç¯å¢ƒåº”åŠ å¯†ï¼‰ |
| role | VARCHAR | è§’è‰²ï¼ˆuser/adminï¼‰ |

#### user_footprintsï¼ˆç”¨æˆ·è¶³è¿¹è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID | ä¸»é”® |
| user_id | UUID | ç”¨æˆ· ID |
| entity_id | UUID | å®ä½“ ID |
| visited_at | TIMESTAMP | è®¿é—®æ—¶é—´ |

#### placeï¼ˆåœ°ç‚¹è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID | ä¸»é”® |
| name | VARCHAR | åœ°ç‚¹åç§° |
| wgs84 | JSONB | WGS84 åæ ‡ï¼ˆ{"lat": xx, "lng": xx}ï¼‰ |

### Neo4j å›¾ç»“æ„

#### èŠ‚ç‚¹ç±»å‹

- **Node**ï¼šçŸ¥è¯†å›¾è°±èŠ‚ç‚¹

#### èŠ‚ç‚¹å±æ€§

- `id`ï¼šèŠ‚ç‚¹ IDï¼ˆå¯¹åº” cultural_entity.kg_node_idï¼‰
- `name`ï¼šèŠ‚ç‚¹åç§°

#### å…³ç³»ç±»å‹

- æ ¹æ®å®é™…æ•°æ®å®šä¹‰ï¼ˆå¦‚ `RELATED_TO`ã€`BELONGS_TO` ç­‰ï¼‰

## ğŸ’» å¼€å‘æŒ‡å—

### å¼€å‘ç¯å¢ƒè®¾ç½®

1. å®‰è£…å¼€å‘ä¾èµ–
2. é…ç½®æ•°æ®åº“è¿æ¥
3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

### ä»£ç è§„èŒƒ

- ä½¿ç”¨ ES6+ è¯­æ³•
- æ¨¡å—åŒ–å¼€å‘ï¼ˆES Modulesï¼‰
- éµå¾ª JavaScript æœ€ä½³å®è·µ
- æ³¨é‡Šé‡è¦é€»è¾‘

### æ·»åŠ æ–°åŠŸèƒ½

1. **åç«¯**ï¼š
   - åœ¨ `backend/db.js` ä¸­æ·»åŠ æ•°æ®åº“æ“ä½œå‡½æ•°
   - åœ¨ `backend/server.js` ä¸­æ·»åŠ  API è·¯ç”±
   - å¦‚éœ€çŸ¥è¯†å›¾è°±ï¼Œåœ¨ `backend/neo4j.js` ä¸­æ·»åŠ æŸ¥è¯¢å‡½æ•°

2. **å‰ç«¯**ï¼š
   - åˆ›å»ºæ–°çš„ HTML é¡µé¢ï¼ˆå¦‚éœ€è¦ï¼‰
   - åœ¨ `frontend/assets/js/` ä¸­æ·»åŠ  JavaScript æ¨¡å—
   - æ›´æ–°æ ·å¼æ–‡ä»¶

### è°ƒè¯•æŠ€å·§

- ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·æŸ¥çœ‹ç½‘ç»œè¯·æ±‚
- æ£€æŸ¥æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
- ä½¿ç”¨ `console.log` è°ƒè¯•ï¼ˆç”Ÿäº§ç¯å¢ƒå‰ç§»é™¤ï¼‰

## â“ å¸¸è§é—®é¢˜

### 1. æ•°æ®åº“è¿æ¥å¤±è´¥

- æ£€æŸ¥ PostgreSQL/Neo4j æœåŠ¡æ˜¯å¦å¯åŠ¨
- éªŒè¯è¿æ¥é…ç½®ï¼ˆä¸»æœºã€ç«¯å£ã€ç”¨æˆ·åã€å¯†ç ï¼‰
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### 2. å‰ç«¯æ— æ³•åŠ è½½æ•°æ®

- æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ
- éªŒè¯ `SERVER_URL` é…ç½®æ˜¯å¦æ­£ç¡®
- æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯
- æ£€æŸ¥ CORS é…ç½®

### 3. 3D æ¨¡å‹æ— æ³•æ˜¾ç¤º

- ç¡®è®¤æ¨¡å‹æ–‡ä»¶è·¯å¾„æ­£ç¡®
- æ£€æŸ¥æ¨¡å‹æ ¼å¼ï¼ˆGLTF/GLBï¼‰
- æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„åŠ è½½é”™è¯¯

### 4. åœ°å›¾ä¸æ˜¾ç¤º

- æ£€æŸ¥ Leaflet åº“æ˜¯å¦åŠ è½½
- éªŒè¯åœ°å›¾å®¹å™¨ ID å’Œæ ·å¼
- æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼ˆéœ€è¦åŠ è½½åœ°å›¾ç“¦ç‰‡ï¼‰

### 5. æ‰‹åŠ¿è¯†åˆ«ä¸å·¥ä½œ

- ç¡®è®¤æ‘„åƒå¤´æƒé™å·²æˆäºˆ
- æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒ MediaPipe
- æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork æœ¬é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

### è´¡çŒ®ç±»å‹

- ğŸ› Bug ä¿®å¤
- âœ¨ æ–°åŠŸèƒ½
- ğŸ“ æ–‡æ¡£æ”¹è¿›
- ğŸ¨ UI/UX ä¼˜åŒ–
- âš¡ æ€§èƒ½ä¼˜åŒ–

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- æäº¤ Issue
- å‘é€é‚®ä»¶è‡³2023302131244@whu.edu.cn

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®ï¼š

- [Three.js](https://threejs.org/) - 3D å›¾å½¢åº“
- [Leaflet](https://leafletjs.com/) - åœ°å›¾åº“
- [Neo4j](https://neo4j.com/) - å›¾æ•°æ®åº“
- [Express.js](https://expressjs.com/) - Web æ¡†æ¶
- [Tailwind CSS](https://tailwindcss.com/) - CSS æ¡†æ¶

---

**æ–‡åŒ–æ˜Ÿäº‘** - è®©ä¸­åæ–‡æ˜åœ¨æ•°å­—ä¸–ç•Œä¸­é—ªè€€ âœ¨



